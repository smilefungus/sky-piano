<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Sky Piano</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- 右上角放大/缩小按钮 -->
    <div class="controls">
      <button id="zoomIn" class="ctrlBtn">放大</button>
      <button id="zoomOut" class="ctrlBtn">缩小</button>
      <button id="toggleFullscreen" class="ctrlBtn">全屏</button>
    </div>

    <!-- 横屏提示/授权层 -->
    <div id="orientationOverlay" class="overlay">
      <div class="overlayInner">
        <h2 class="overlayTitle">建议横屏使用</h2>
        <p class="overlayText">
          为更好的演奏体验，建议将手机横屏。若浏览器支持，我们将尝试自动切换到横屏并解锁音频。
        </p>
        <div class="overlayActions">
          <button id="tryLandscape" class="overlayBtn primary">
            尝试横屏并继续
          </button>
          <button id="continuePortrait" class="overlayBtn">继续竖屏使用</button>
        </div>
      </div>
    </div>

    <div class="container">
      <h1>光遇钢琴小圆点（3×5）</h1>
      <p class="hint">
        键位：第1组 <span class="kbd">1</span>–<span class="kbd">5</span>，第2组
        <span class="kbd">Q</span>–<span class="kbd">T</span>，第3组
        <span class="kbd">A</span>–<span class="kbd">G</span>
      </p>
      <div class="card">
        <div id="piano" class="piano"></div>
      </div>
      <p class="footer">提示：支持多点触控，点击按键或按对应键盘键进行播放。</p>

      <!-- 简谱文本与自动演奏（已移除图片识别） -->
      <div class="sheet">
        <div class="sheetGrid">
          <div class="sheetItem">
            <h3>简谱文本与演奏</h3>
            <textarea
              id="sheetText"
              rows="6"
              placeholder="在此输入或粘贴简谱（支持 0-7、.、-、*时值，空格换行分隔）"
              class="sheetInput"
            ></textarea>
            <div class="metaRow" style="margin-top: 8px">
              <label
                >速度(BPM)：<input
                  id="bpm"
                  type="number"
                  value="90"
                  min="40"
                  max="200"
              /></label>
              <label>每拍时值(ms)：<span id="beatMs">667</span></label>
            </div>
            <div class="sheetActions">
              <button id="playSheetBtn" class="sheetBtn primary">
                按简谱自动演奏
              </button>
              <button id="parseOnlyBtn" class="sheetBtn">仅解析</button>
              <button id="clearTextBtn" class="sheetBtn">清除文本</button>
            </div>
            <div
              id="parseOutput"
              style="margin-top: 8px; color: var(--muted); font-size: 12px"
            ></div>
          </div>
        </div>
      </div>

      <!-- 歌曲名称查询简谱（本地库） -->
      <div class="search">
        <div class="searchGrid">
          <div class="sheetItem">
            <h3>根据歌曲名称查询简谱（本地库）</h3>
            <input
              id="songQuery"
              type="text"
              class="sheetInput"
              placeholder="输入歌曲名称，如：小星星、生日快乐"
            />
            <div class="sheetActions">
              <button id="searchSongBtn" class="sheetBtn primary">搜索</button>
              <button id="resetLibraryBtn" class="sheetBtn">
                恢复默认歌曲库
              </button>
            </div>
            <div id="searchResults" class="resultList"></div>
            <div class="sheetActions">
              <button id="playFoundBtn" class="sheetBtn primary">
                弹奏查询结果
              </button>
            </div>
          </div>
          <div class="sheetItem">
            <h3>导入/扩展歌曲库（JSON）</h3>
            <input
              id="songJsonFile"
              type="file"
              accept="application/json"
              class="sheetInput"
            />
            <div class="sheetActions">
              <button id="loadSongJsonBtn" class="sheetBtn">
                加载 JSON 文件
              </button>
            </div>
            <div style="color: var(--muted); font-size: 12px; margin-top: 8px">
              支持两种格式：<br />
              1) 数组：[{"title":"小星星","jianpu":"1 1 5 5 6 6 5 - ..."}]<br />
              2) 映射：{"小星星":"1 1 5 5 6 6 5 - ..."}
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
