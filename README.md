# Sky Piano 光遇钢琴小圆点

## 页面功能分析

### 1. 钢琴核心功能

- **3×5按键布局**：15个圆形按键组成的钢琴界面
- **多点触控支持**：支持同时按下多个按键
- **双输入方式**：
  - 鼠标/触摸点击按键
  - 键盘按键对应（1-5, Q-T, A-G）
- **视觉反馈**：按键按下时有高亮效果

### 2. 界面控制功能

- **缩放控制**：右上角的放大/缩小按钮，可调整按键大小
- **自适应布局**：根据屏幕尺寸自动调整按键大小和间距
- **横屏提示**：移动端竖屏时提示用户横屏使用以获得更好体验

### 3. 简谱自动演奏

- **文本输入**：支持直接输入或粘贴简谱文本
- **简谱解析**：支持音符（1-7）、休止符（0）、高低音（.）、时值延长（-）和时值倍数（\*）
- **速度控制**：可调整BPM（40-200）
- **自动演奏**：根据解析的简谱自动播放对应的音符

### 4. 歌曲库功能

- **本地歌曲库**：内置几首经典歌曲（小星星、生日快乐、两只老虎）
- **歌曲搜索**：根据歌曲名称搜索匹配的简谱
- **自定义导入**：支持导入JSON格式的自定义歌曲库
- **一键演奏**：选择歌曲后可直接自动演奏

## 实现步骤

### 1. 项目结构搭建

- 创建项目根目录和bgm音频文件夹
- 放置15个音符音频文件（b1.mp3至d1.mp3）
- 创建index.html主页面文件

### 2. 页面布局设计

- 设计深色主题的钢琴界面，使用CSS Grid布局排列15个圆形按键
- 实现响应式设计，适配不同屏幕尺寸
- 添加控制按钮、提示信息和功能区域

### 3. 音频播放实现

- 使用Web Audio API实现稳定的音频播放
- 实现音频缓存机制，提高播放性能
- 支持同时播放多个音符（并发播放）

### 4. 输入控制实现

- 实现鼠标/触摸事件处理，支持多点触控
- 实现键盘事件处理，映射按键到对应的音符
- 添加按键按下/释放的视觉反馈

### 5. 缩放与自适应功能

- 实现按键大小和间距的动态调整
- 添加放大/缩小按钮的事件监听
- 实现窗口大小变化时的自动调整

### 6. 简谱解析与自动演奏

- 实现简谱文本解析逻辑，支持各种简谱符号
- 实现BPM到每拍毫秒数的转换
- 实现自动演奏的时间控制逻辑

### 7. 歌曲库功能实现

- 设计歌曲库数据结构和存储方式
- 实现歌曲搜索和结果展示功能
- 实现歌曲选择和自动演奏功能
- 实现JSON格式的歌曲库导入功能

## 技术栈

- **前端技术**：HTML5, CSS3, JavaScript (ES6+)
- **音频处理**：Web Audio API
- **布局技术**：CSS Grid, Flexbox
- **响应式设计**：Media Queries
- **交互处理**：DOM事件监听，触摸事件处理

## 春节主题样式

页面已采用春节主题配色方案：

- **主色调**：红色（#8b0000）和金色（#ffd700）
- **背景**：红色渐变背景，营造节日氛围
- **文字**：暖白色文字，提高可读性
- **强调色**：金色作为按钮和高亮元素的颜色
- **按键**：保留白色按键设计，与节日主题形成对比

## 使用说明

1. **手动演奏**：点击钢琴按键或按对应键盘键（1-5, Q-T, A-G）
2. **调整界面**：点击右上角的放大/缩小按钮调整按键大小
3. **自动演奏简谱**：
   - 在"简谱文本与演奏"区域输入简谱
   - 调整BPM速度
   - 点击"按简谱自动演奏"按钮
4. **使用歌曲库**：
   - 在"根据歌曲名称查询简谱"区域输入歌曲名称
   - 点击"搜索"按钮
   - 选择搜索结果，点击"弹奏查询结果"按钮
5. **导入歌曲库**：
   - 选择JSON格式的歌曲库文件
   - 点击"加载JSON文件"按钮

## 简谱格式说明

- **音符**：1-7表示基本音符
- **休止符**：0表示休止
- **高低音**：
  - 音符前加.表示低音（如.1）
  - 音符后加.表示高音（如1.）
- **时值延长**：-表示延长一拍
- **时值倍数**：*x表示时值倍数（可小数，如5*1.5表示1.5拍）
- **分隔**：使用空格或换行分隔不同音符

示例：小星星简谱 `1 1 5 5 6 6 5*2 4 4 3 3 2 2 1*2`

## 自定义歌曲库格式

支持两种JSON格式：

1. 数组格式：

```json
[
  { "title": "小星星", "jianpu": "1 1 5 5 6 6 5*2 4 4 3 3 2 2 1*2" },
  {
    "title": "生日快乐",
    "jianpu": "5 5 6 5 1*2 7 5 5 6 5 2*2 1 5 5 5*1.5 3*0.5 1 7 6*2 4*1.5 4*0.5 3 1 2 1*2"
  }
]
```

2. 映射格式：

```json
{
  "小星星": "1 1 5 5 6 6 5*2 4 4 3 3 2 2 1*2",
  "生日快乐": "5 5 6 5 1*2 7 5 5 6 5 2*2 1 5 5 5*1.5 3*0.5 1 7 6*2 4*1.5 4*0.5 3 1 2 1*2"
}
```
